<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="AudioSpectrumVisualizer开发记录文档">
    <title>AudioSpectrumVisualizer开发记录文档</title>
    <link rel="stylesheet" href="css/shCoreFadeToGrey.css">
    <style type="text/css">
        html, body {
            margin: 0;
            font-family: arial, "Microsoft YaHei";
            background-color: #272822;
            color: #FEFEFE;
        }

        h2, h2, h3, h4, h5, h6 {
            width: 100%;
            text-align: center;
        }

        w {
            margin: 0 10px;
        }

        .h {
            position: relative;
            width: 80%;
            margin: 5px auto;
        }

        img {
            position: relative;
            display: block;
            width: 300px;
            height: 170px;
            margin: 15px 0 15px 150px;
        }

        .f {
            position: static;
            display: inline;
            width: 22px;
            height: 22px;
            margin: 10px 5px 0 5px;
        }

        paragraph {
            padding-left: 25px;
            margin: 10px 0;
        }

        .codeContent {
            position: relative;
            width: 95%;
            font-size: 9px;
            margin: 5px auto;
            border: solid 1px #ffffff;
        }

        a {
            text-decoration: none;
            color: cyan;
        }

        a:hover {
            color: yellow;
        }
    </style>

</head>
<body>
<p>
<h2>AudioSpectrumVisualizer</h2></p>
<p><h4>一、关于AudioSpectrumVisualizer</h4></p>
<p class="h">1、AudioSpectrumVisualizer是什么呢?<br>
    <paragraph>AudioSpectrumVisualizer是音频频谱可视化,说白了就是播放音频的时候把数据展示出来。</paragraph>

</p>
<p class="h">2、想要达到什么效果呢？<br>
    <paragraph>
        播放音乐就像这样<img class="f" src="images/face/0.gif"><br><img src="images/1.gif">
    </paragraph>
    <br>
    <paragraph>
        或者这样<img class="f" src="images/face/2.png"><br><img src="images/2.gif">
    </paragraph>
    <br>
    <paragraph>
        这样?<img class="f" src="images/face/3.gif"><br><img src="images/3.gif">
    </paragraph>

</p>
<p><h4>二、开发步骤</h4></p>
<p class="h">1、想要展示肯定是要先获取播放数据
    <br>
    <paragraph>
        获取文件数据需要请求文件地址返回ArrayBuffer
    </paragraph>
    <br>
    <paragraph>
        ArrayBuffer是什么呢？
    </paragraph>
    <br>
    <paragraph>
        这个ArrayBuffer类型化数组，类型化数组是JavaScript操作二进制数据的一个接口。最初为了满足JavaScript与显卡之间大量的、实时的数据交换，
        它们之间的数据通信必须是二进制的，而不能是传统的文本格式的背景下诞生的。类型化数组是建立在ArrayBuffer对象的基础上的。它的作用是，分配一段可以存放数据的连续内存区域。
    </paragraph>
    <br>
    <paragraph>
        ArrayBuffer作为内存区域，可以存放多种类型的数据。不同数据有不同的存储方式，这就叫做“视图”。目前，JavaScript提供以下类型的视图：
    </paragraph>
    <br>
    <paragraph>
        Int8Array：8位有符号整数，长度1个字节。
    </paragraph>
    <br>
    <paragraph>
        Uint8Array：8位无符号整数，长度1个字节。
    </paragraph>
    <br>
    <paragraph>
        Int16Array：16位有符号整数，长度2个字节。
    </paragraph>
    <br>
    <paragraph>
        Uint16Array：16位无符号整数，长度2个字节。
    </paragraph>
    <br>
    <paragraph>
        Int32Array：32位有符号整数，长度4个字节。
    </paragraph>
    <br>
    <paragraph>
        Uint32Array：32位无符号整数，长度4个字节。
    </paragraph>
    <br>
    <paragraph>
        Float32Array：32位浮点数，长度4个字节。
    </paragraph>
    <br>
    <paragraph>
        Float64Array：64位浮点数，长度8个字节。
    </paragraph>
    <br>
    <br>
    <paragraph>
        还有一个需要注意的是请求文件要在服务器环境下才能正常运行要不然会报一个 <br>
        XMLHttpRequest cannot load file:///E:/music/1.mp3. Cross origin requests are only supported for protocol
        schemes: http, data, chrome, se-extension, https, chrome-extension-resource.loadSound @ visualizer.js:44
        <br>
        file:///E:/images/bg_2.jpg Failed to load resource: net::ERR_FILE_NOT_FOUND
        <br>
        也就是说XMLHttpRequest 中的 open()认为这不在一个域里面,参考<a
            href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank">浏览器的同源策略</a>
    </paragraph>
</p>
<div class="codeContent">
    <div id="highlighter_316943" class="syntaxhighlighter nogutter  js">
        <div class="toolbar"><span><a href="https://github.com/Poppinrubo/AudioSpectrumVisualizer" class="toolbar_item command_help help">?</a></span></div>
        <table border="0" cellpadding="0" cellspacing="0">
            <tbody>
            <tr>
                <td class="code">
                    <div class="container">
                        <div class="line number1 index0 alt2"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//实例化一个音频类型window.AudioContext</code>
                        </div>
                        <div class="line number2 index1 alt1"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">function</code>&nbsp;<code class="js plain">windowAudioContext()&nbsp;{</code>
                        </div>
                        <div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//下面这些是为了统一Chrome和Firefox的AudioContext</code></div>
                        <div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">window.AudioContext&nbsp;=&nbsp;window.AudioContext&nbsp;||&nbsp;window.webkitAudioContext&nbsp;||&nbsp;window.mozAudioContext&nbsp;||&nbsp;window.msAudioContext;</code>
                        </div>
                        <div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">window.requestAnimationFrame&nbsp;=&nbsp;window.requestAnimationFrame&nbsp;||&nbsp;window.webkitRequestAnimationFrame&nbsp;||&nbsp;window.mozRequestAnimationFrame&nbsp;||&nbsp;window.msRequestAnimationFrame;</code>
                        </div>
                        <div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">window.cancelAnimationFrame&nbsp;=&nbsp;window.cancelAnimationFrame&nbsp;||&nbsp;window.webkitCancelAnimationFrame&nbsp;||&nbsp;window.mozCancelAnimationFrame&nbsp;||&nbsp;window.msCancelAnimationFrame;</code>
                        </div>
                        <div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">try</code>&nbsp;<code class="js plain">{</code></div>
                        <div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">Myself.audioContext&nbsp;=&nbsp;</code><code
                                class="js keyword">new</code>&nbsp;<code class="js plain">AudioContext();</code></div>
                        <div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//AudioContext实例化后就拉取音频</code></div>
                        <div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">loadSound();</code></div>
                        <div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}&nbsp;</code><code class="js keyword">catch</code>&nbsp;<code
                                class="js plain">(e)&nbsp;{</code></div>
                        <div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">console.log(e&nbsp;+&nbsp;</code><code class="js string">',您的浏览器不支持&nbsp;AudioContext'</code><code
                                class="js plain">);</code></div>
                        <div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}</code></div>
                        <div class="line number14 index13 alt1"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div>
                        <div class="line number15 index14 alt2">&nbsp;</div>
                        <div class="line number16 index15 alt1"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//加载音频对象方法</code></div>
                        <div class="line number17 index16 alt2"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">function</code>&nbsp;<code class="js plain">loadSound()&nbsp;{</code>
                        </div>
                        <div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code
                                class="js plain">request&nbsp;=&nbsp;</code><code
                                class="js keyword">new</code>&nbsp;<code class="js plain">XMLHttpRequest();&nbsp;</code><code
                                class="js comments">//建立一个请求</code></div>
                        <div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">request.open(</code><code class="js string">'GET'</code><code
                                class="js plain">,&nbsp;Myself.audioUrl,&nbsp;</code><code
                                class="js keyword">true</code><code class="js plain">);&nbsp;</code><code
                                class="js comments">//配置请求类型，文件路径,路径不可跨域</code></div>
                        <div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">request.responseType&nbsp;=&nbsp;</code><code class="js string">'arraybuffer'</code><code
                                class="js plain">;&nbsp;</code><code class="js comments">//配置数据返回类型</code></div>
                        <div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">request.onload&nbsp;=&nbsp;</code><code
                                class="js keyword">function</code>&nbsp;<code class="js plain">()&nbsp;{</code></div>
                        <div class="line number22 index21 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//拉取成功返回ArrayBuffer(一块内存空间,缓冲),调用播放</code></div>
                        <div class="line number23 index22 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">play(request.response);</code></div>
                        <div class="line number24 index23 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}</code></div>
                        <div class="line number25 index24 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">request.send();</code></div>
                        <div class="line number26 index25 alt1"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div>
                        <div class="line number27 index26 alt2">&nbsp;</div>
                        <div class="line number28 index27 alt1"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//解码播放,提取数据</code></div>
                        <div class="line number29 index28 alt2"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">function</code>&nbsp;<code
                                class="js plain">play(audioData)&nbsp;{</code></div>
                        <div class="line number30 index29 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code class="js plain">audioContext&nbsp;=&nbsp;Myself.audioContext;</code>
                        </div>
                        <div class="line number31 index30 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//解码ArrayBuffer</code></div>
                        <div class="line number32 index31 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">audioContext.decodeAudioData(audioData).then(</code><code
                                class="js keyword">function</code>&nbsp;<code
                                class="js plain">(decodedData)&nbsp;{</code></div>
                        <div class="line number33 index32 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//进来到这里代表解码完成</code></div>
                        <div class="line number34 index33 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//AudioBuffer接口表示存在存储器里的短音频资产，利用AudioContext.decodeAudioData()方法从音频文件构建，</code>
                        </div>
                        <div class="line number35 index34 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//&nbsp;或者利用&nbsp;AudioContext.createBuffer()构建于原数据。</code></div>
                        <div class="line number36 index35 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//&nbsp;一旦将其放入AudioBuffer，可以传递到一个&nbsp;AudioBufferSourceNode进行播放</code>
                        </div>
                        <div class="line number37 index36 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code class="js plain">audioBufferSouceNode&nbsp;=&nbsp;audioContext.createBufferSource(),</code>
                        </div>
                        <div class="line number38 index37 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">analyser&nbsp;=&nbsp;audioContext.createAnalyser();</code></div>
                        <div class="line number39 index38 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//将source与分析器连接</code></div>
                        <div class="line number40 index39 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">audioBufferSouceNode.connect(analyser);</code></div>
                        <div class="line number41 index40 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//将分析器与destination连接，形成到达扬声器的通路</code></div>
                        <div class="line number42 index41 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">analyser.connect(audioContext.destination);</code></div>
                        <div class="line number43 index42 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//将上面解码得到的decodedData数据赋值给source</code></div>
                        <div class="line number44 index43 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">audioBufferSouceNode.buffer&nbsp;=&nbsp;decodedData;</code></div>
                        <div class="line number45 index44 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//播放,到这里就可以听到声音了</code></div>
                        <div class="line number46 index45 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">audioBufferSouceNode.start(0);</code></div>
                        <div class="line number47 index46 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//接下来把分析器传出去创建频谱</code></div>
                        <div class="line number48 index47 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">drawSpectrum(analyser);</code></div>
                        <div class="line number49 index48 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">},&nbsp;</code><code class="js keyword">function</code>&nbsp;<code
                                class="js plain">(e)&nbsp;{</code></div>
                        <div class="line number50 index49 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">console.log(e&nbsp;+&nbsp;</code><code
                                class="js string">",文件解码失败!"</code><code class="js plain">);</code></div>
                        <div class="line number51 index50 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">});</code></div>
                        <div class="line number52 index51 alt1">&nbsp;</div>
                        <div class="line number53 index52 alt2"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<br>
<paragraph>
    暂时先这样^^^^^^^^^^^^^^^^^^^^^^^^^^^
    <br>

</paragraph>
<paragraph>
    呃~ 继续 接着昨天的<img class="f" src="images/face/4.gif">
</paragraph>
<br>
<p class="h">2、根据获取的数据画出频谱
    <br>
    <paragraph>
        绘制需要用canvas标签来当容器
    </paragraph>
</p>

<div class="codeContent">
    <div id="highlighter_362021" class="syntaxhighlighter nogutter  js">
        <div class="toolbar"><span><a href="https://github.com/Poppinrubo/AudioSpectrumVisualizer" class="toolbar_item command_help help">?</a></span></div>
        <table border="0" cellpadding="0" cellspacing="0">
            <tbody>
            <tr>
                <td class="code">
                    <div class="container">
                        <div class="line number1 index0 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code class="js plain">canvas&nbsp;=&nbsp;document.getElementById(Myself.canvasId),</code>
                        </div>
                        <div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">cwidth&nbsp;=&nbsp;canvas.width,</code></div>
                        <div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">cheight&nbsp;=&nbsp;canvas.height&nbsp;-&nbsp;2,</code></div>
                        <div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">meterWidth&nbsp;=&nbsp;10,&nbsp;</code><code class="js comments">//频谱条宽度</code>
                        </div>
                        <div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">gap&nbsp;=&nbsp;2,&nbsp;</code><code class="js comments">//频谱条间距</code>
                        </div>
                        <div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">capHeight&nbsp;=&nbsp;2,</code></div>
                        <div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">capStyle&nbsp;=&nbsp;</code><code class="js string">'#fff'</code><code
                                class="js plain">,</code></div>
                        <div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">meterNum&nbsp;=&nbsp;800&nbsp;/&nbsp;(10&nbsp;+&nbsp;2),&nbsp;</code><code
                                class="js comments">//频谱条数量</code></div>
                        <div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">capYPositionArray&nbsp;=&nbsp;[];&nbsp;</code><code
                                class="js comments">//将上一画面各帽头的位置保存到这个数组</code></div>
                        <div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">ctx&nbsp;=&nbsp;canvas.getContext(</code><code
                                class="js string">'2d'</code><code class="js plain">),</code></div>
                        <div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">gradient&nbsp;=&nbsp;ctx.createLinearGradient(0,&nbsp;0,&nbsp;0,&nbsp;300);</code>
                        </div>
                        <div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">gradient.addColorStop(1,&nbsp;Myself.color);</code></div>
                        <div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code
                                class="js plain">drawMeter&nbsp;=&nbsp;</code><code class="js keyword">function</code>&nbsp;<code
                                class="js plain">()&nbsp;{</code></div>
                        <div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code class="js plain">array&nbsp;=&nbsp;</code><code
                                class="js keyword">new</code>&nbsp;<code class="js plain">Uint8Array(analyser.frequencyBinCount);</code>
                        </div>
                        <div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">analyser.getByteFrequencyData(array);</code></div>
                        <div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code class="js plain">step&nbsp;=&nbsp;Math.round(array.length&nbsp;/&nbsp;meterNum);&nbsp;</code><code
                                class="js comments">//计算采样步长</code></div>
                        <div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">ctx.clearRect(0,&nbsp;0,&nbsp;cwidth,&nbsp;cheight);</code></div>
                        <div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">for</code>&nbsp;<code class="js plain">(</code><code
                                class="js keyword">var</code>&nbsp;<code class="js plain">i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;meterNum;&nbsp;i++)&nbsp;{</code>
                        </div>
                        <div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">var</code>&nbsp;<code class="js plain">value&nbsp;=&nbsp;array[i&nbsp;*&nbsp;step];&nbsp;</code><code
                                class="js comments">//获取当前能量值</code></div>
                        <div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">if</code>&nbsp;<code class="js plain">(capYPositionArray.length&nbsp;&lt;&nbsp;Math.round(meterNum))&nbsp;{</code>
                        </div>
                        <div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">capYPositionArray.push(value);&nbsp;</code><code class="js comments">//初始化保存帽头位置的数组，将第一个画面的数据压入其中</code>
                        </div>
                        <div class="line number22 index21 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}</code></div>
                        <div class="line number23 index22 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">;</code></div>
                        <div class="line number24 index23 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">ctx.fillStyle&nbsp;=&nbsp;capStyle;</code></div>
                        <div class="line number25 index24 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//开始绘制帽头</code></div>
                        <div class="line number26 index25 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js keyword">if</code>&nbsp;<code class="js plain">(value&nbsp;&lt;&nbsp;capYPositionArray[i])&nbsp;{&nbsp;</code><code
                                class="js comments">//如果当前值小于之前值</code></div>
                        <div class="line number27 index26 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">ctx.fillRect(i&nbsp;*&nbsp;12,&nbsp;cheight&nbsp;-&nbsp;(--capYPositionArray[i]),&nbsp;meterWidth,&nbsp;capHeight);&nbsp;</code><code
                                class="js comments">//则使用前一次保存的值来绘制帽头</code></div>
                        <div class="line number28 index27 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}&nbsp;</code><code class="js keyword">else</code>&nbsp;<code
                                class="js plain">{</code></div>
                        <div class="line number29 index28 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">ctx.fillRect(i&nbsp;*&nbsp;12,&nbsp;cheight&nbsp;-&nbsp;value,&nbsp;meterWidth,&nbsp;capHeight);&nbsp;</code><code
                                class="js comments">//否则使用当前值直接绘制</code></div>
                        <div class="line number30 index29 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">capYPositionArray[i]&nbsp;=&nbsp;value;</code></div>
                        <div class="line number31 index30 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}</code></div>
                        <div class="line number32 index31 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">;</code></div>
                        <div class="line number33 index32 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js comments">//开始绘制频谱条</code></div>
                        <div class="line number34 index33 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">ctx.fillStyle&nbsp;=&nbsp;gradient;</code></div>
                        <div class="line number35 index34 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">ctx.fillRect(i&nbsp;*&nbsp;12,&nbsp;cheight&nbsp;-&nbsp;value&nbsp;+&nbsp;capHeight,&nbsp;meterWidth,&nbsp;cheight);</code>
                        </div>
                        <div class="line number36 index35 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}</code></div>
                        <div class="line number37 index36 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">requestAnimationFrame(drawMeter);</code></div>
                        <div class="line number38 index37 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">}</code></div>
                        <div class="line number39 index38 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code
                                class="js plain">requestAnimationFrame(drawMeter);</code></div>
                        <div class="line number40 index39 alt1"><code
                                class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<p class="h">到这里就出效果了
    <br><img src="images/4.gif">
</p>
<p class="h">貌似和预想差那么点,慢慢调吧,想把它做怎可视化播放器怎么办<img class="f" src="images/face/6.png">,先完结吧<img class="f" src="images/face/5.gif">慢慢再说，<a href="https://github.com/Poppinrubo/AudioSpectrumVisualizer">github</a>
</p>
</body>
</html>